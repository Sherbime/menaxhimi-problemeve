<!DOCTYPE html>
<html lang="sq">
<head>
  <meta charset="UTF-8" />
  <title>Menaxhimi i Problemeve me Firebase</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
      background-color: #f4f4f4;
    }
    h2 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background-color: #fff;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ccc;
      text-align: left;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    .actions button {
      margin-right: 5px;
      padding: 5px 10px;
      cursor: pointer;
    }
    .form-container {
      margin-bottom: 20px;
    }
    input[type="text"] {
      padding: 8px;
      margin-right: 10px;
      width: 200px;
    }
    button.add-btn {
      padding: 8px 15px;
      background-color: #28a745;
      color: white;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h2>ðŸ“‹ Tabela e Problemeve me Firebase</h2>

  <div class="form-container">
    <input type="text" id="problemi" placeholder="Problemi" />
    <input type="text" id="pershkrimi" placeholder="PÃ«rshkrimi" />
    <button class="add-btn" onclick="shtoRresht()">Shto</button>
  </div>

  <table id="tabelaProblemeve">
    <thead>
      <tr>
        <th>Nr</th>
        <th>Data e Krijimit</th>
        <th>Problemi</th>
        <th>PÃ«rshkrimi</th>
        <th>Veprime</th>
      </tr>
    </thead>
    <tbody>
      <!-- Rreshtat do shtohen kÃ«tu -->
    </tbody>
  </table>

  <!-- Firebase App (the core Firebase SDK) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBija0DnZ5RQE2f1lbgOH38I86HyFhkT74",
      authDomain: "menaxhimi-problemeve.firebaseapp.com",
      projectId: "menaxhimi-problemeve",
      storageBucket: "menaxhimi-probleve.firebasestorage.app",
      messagingSenderId: "360048662808",
      appId: "1:360048662808:web:52d4177262dcd4ef18266d",
      measurementId: "G-7GF7L4L5Y1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tabela = document.getElementById('tabelaProblemeve').getElementsByTagName('tbody')[0];

    // Funksioni pÃ«r tÃ« ngarkuar problemet nga Firestore nÃ« tabelÃ«
    async function ngarkoProblemet() {
      tabela.innerHTML = ""; // Pastro tabelÃ«n

      const snapshot = await getDocs(collection(db, "problemet"));
      let nr = 1;

      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const rreshti = tabela.insertRow();

        rreshti.setAttribute('data-id', docSnap.id);

        rreshti.insertCell(0).innerText = nr++;
        rreshti.insertCell(1).innerText = data.dataKrijimit ? new Date(data.dataKrijimit.seconds * 1000).toLocaleDateString('sq-AL') : "-";
        rreshti.insertCell(2).innerText = data.problemi;
        rreshti.insertCell(3).innerText = data.pershkrimi;

        const veprimeCell = rreshti.insertCell(4);
        veprimeCell.className = "actions";
        veprimeCell.innerHTML = `
          <button onclick="modifikoRresht('${docSnap.id}')">Modifiko</button>
          <button onclick="fshiRresht('${docSnap.id}')">Fshi</button>
        `;
      });
    }

    // Funksioni pÃ«r tÃ« shtuar problem tÃ« ri nÃ« Firestore
    async function shtoRresht() {
      const problemi = document.getElementById('problemi').value.trim();
      const pershkrimi = document.getElementById('pershkrimi').value.trim();

      if (!problemi || !pershkrimi) return alert("PlotÃ«so tÃ« dy fushat!");

      await addDoc(collection(db, "problemet"), {
        problemi,
        pershkrimi,
        dataKrijimit: serverTimestamp()
      });

      document.getElementById('problemi').value = "";
      document.getElementById('pershkrimi').value = "";

      ngarkoProblemet();
    }

    // Funksioni pÃ«r tÃ« fshirÃ« rreshtin nga Firestore
    async function fshiRresht(id) {
      if (confirm("Je i sigurt qÃ« dÃ«shiron ta fshish kÃ«tÃ« problem?")) {
        await deleteDoc(doc(db, "problemet", id));
        ngarkoProblemet();
      }
    }

    // Funksioni pÃ«r modifikim (thjesht alert pÃ«r momentin, mund ta pÃ«rmirÃ«sojmÃ«)
    async function modifikoRresht(id) {
      const docRef = doc(db, "problemet", id);
      const docSnap = await getDocs(docRef);

      // PÃ«r momentin pÃ«rdor prompt (mund ta bÃ«jmÃ« modal mÃ« tÃ« mirÃ« mÃ« vonÃ«)
      const problemi = prompt("Ndrysho Problemin:");
      const pershkrimi = prompt("Ndrysho PÃ«rshkrimin:");

      if (!problemi || !pershkrimi) return;

      // PÃ«rditÃ«so dokumentin nÃ« Firestore
      await docRef.update({
        problemi: problemi.trim(),
        pershkrimi: pershkrimi.trim()
      });

      ngarkoProblemet();
    }

    // Ngarko problemet kur hapet faqja
    window.onload = ngarkoProblemet;
  </script>

</body>
</html>
